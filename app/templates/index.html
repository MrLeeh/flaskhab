{% extends "base.html" %}


{% block scripts %}
{{ super() }}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script>
  $(document).ready(function() {
    var socket = io.connect({% if SSL %}'https://'{% else %}'http://'{% endif %} + document.domain + ':' + location.port);

    socket.on('mqtt_message', function(data) {
      console.log(data);
      $row = $('#mqtt-item-' + data.id);
      $row.prop('title', data.update_time);
      $row.find('.mqtt-item-value').val(data.value);
    });
  });
</script>
{% endblock %}


{% block content %}
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      {% for panel in panels %}
      <div class="panel panel-default">
        <div class="panel-heading">
          {{ panel.title }}
        </div>
        <div class="panel-body">
          <div class="form-horizontal">
            {% for item in panel.items %}
            <div class="form-group" id="mqtt-item-{{ item.id }}" title="last updated: {{ item.update_time | strftime }}">
              <label class="control-label item-label col-xs-6">
                {% if item.icon %}
                <img class="icon" src="{{ url_for('static', filename='icons/' + item.icon) }}">
                {% endif %}
                {{ item.label }}:
              </label>
              <div class="col-sm-6 col-xs-6">
                <div class="input-group">
                  <input class="form-control mqtt-item-value" readonly value={{ item.value }}>
                  <span class="input-group-addon">{{ item.suffix }}</span>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}